import{bC as ge,c as fe,am as oe,u as ve,f as pe,j as _e,k as Ve,r as x,be as he,n as xe,a as h,w as K,o as Ie,d as m,g as Pe,bc as ke,X as R,t as Ue,bw as Ce,x as ye,R as Y,ah as Se,H as Te,q as we,J as g,K as k,L as s,N as o,Y as C,O as v,b5 as M,b6 as z,b7 as G,b9 as Le,S as j,P as qe,bh as F,T as $,U as B,W as D,bi as f,M as Q,b4 as Qe,Q as J,b8 as Ae}from"./index.9f0a642c.js";import{Q as $e,a as W}from"./QPage.8b9b498d.js";import{Q as Be,b as ae,a as X}from"./position-engine.a9eeaafd.js";import{Q as De}from"./QSlideTransition.7e67a7f0.js";import{Q as Ne,a as le}from"./QTabs.cb6b20f8.js";import{Q as Oe,a as te}from"./QTabPanels.ceadb13f.js";import{Q as je}from"./QList.3446d70a.js";import{u as Re}from"./store.ee3c8643.js";import"./QResizeObserver.8c94f049.js";import"./rtl.b51694b1.js";import"./use-panel.841774ec.js";import"./axios.6b484fa5.js";const w=ge({}),Ee=Object.keys(oe);var N=fe({name:"QExpansionItem",props:{...oe,...ve,...pe,icon:String,label:String,labelLines:[Number,String],caption:String,captionLines:[Number,String],dense:Boolean,toggleAriaLabel:String,expandIcon:String,expandedIcon:String,expandIconClass:[Array,String,Object],duration:Number,headerInsetLevel:Number,contentInsetLevel:Number,expandSeparator:Boolean,defaultOpened:Boolean,hideExpandIcon:Boolean,expandIconToggle:Boolean,switchToggleSide:Boolean,denseToggle:Boolean,group:String,popup:Boolean,headerStyle:[Array,String,Object],headerClass:[Array,String,Object]},emits:[..._e,"click","afterShow","afterHide"],setup(l,{slots:t,emit:A}){const{proxy:{$q:y}}=Pe(),S=Ve(l,y),b=x(l.modelValue!==null?l.modelValue:l.defaultOpened),U=x(null),_=he(),{show:p,hide:r,toggle:u}=xe({showing:b});let V,I;const E=h(()=>`q-expansion-item q-item-type q-expansion-item--${b.value===!0?"expanded":"collapsed"} q-expansion-item--${l.popup===!0?"popup":"standard"}`),H=h(()=>{if(l.contentInsetLevel===void 0)return null;const n=y.lang.rtl===!0?"Right":"Left";return{["padding"+n]:l.contentInsetLevel*56+"px"}}),L=h(()=>l.disable!==!0&&(l.href!==void 0||l.to!==void 0&&l.to!==null&&l.to!=="")),d=h(()=>{const n={};return Ee.forEach(P=>{n[P]=l[P]}),n}),i=h(()=>L.value===!0||l.expandIconToggle!==!0),e=h(()=>l.expandedIcon!==void 0&&b.value===!0?l.expandedIcon:l.expandIcon||y.iconSet.expansionItem[l.denseToggle===!0?"denseIcon":"icon"]),T=h(()=>l.disable!==!0&&(L.value===!0||l.expandIconToggle===!0)),a=h(()=>({expanded:b.value===!0,detailsId:l.targetUid,toggle:u,show:p,hide:r})),c=h(()=>{const n=l.toggleAriaLabel!==void 0?l.toggleAriaLabel:y.lang.label[b.value===!0?"collapse":"expand"](l.label);return{role:"button","aria-expanded":b.value===!0?"true":"false","aria-controls":_.value,"aria-label":n}});K(()=>l.group,n=>{I!==void 0&&I(),n!==void 0&&ee()});function q(n){L.value!==!0&&u(n),A("click",n)}function ne(n){n.keyCode===13&&Z(n,!0)}function Z(n,P){P!==!0&&U.value!==null&&U.value.focus(),u(n),Se(n)}function se(){A("afterShow")}function ie(){A("afterHide")}function ee(){V===void 0&&(V=ke()),b.value===!0&&(w[l.group]=V);const n=K(b,O=>{O===!0?w[l.group]=V:w[l.group]===V&&delete w[l.group]}),P=K(()=>w[l.group],(O,be)=>{be===V&&O!==void 0&&O!==V&&r()});I=()=>{n(),P(),w[l.group]===V&&delete w[l.group],I=void 0}}function de(){const n={class:[`q-focusable relative-position cursor-pointer${l.denseToggle===!0&&l.switchToggleSide===!0?" items-end":""}`,l.expandIconClass],side:l.switchToggleSide!==!0,avatar:l.switchToggleSide},P=[m(Y,{class:"q-expansion-item__toggle-icon"+(l.expandedIcon===void 0&&b.value===!0?" q-expansion-item__toggle-icon--rotated":""),name:e.value})];return T.value===!0&&(Object.assign(n,{tabindex:0,...c.value,onClick:Z,onKeyup:ne}),P.unshift(m("div",{ref:U,class:"q-expansion-item__toggle-focus q-icon q-focus-helper q-focus-helper--rounded",tabindex:-1}))),m(X,n,()=>P)}function re(){let n;return t.header!==void 0?n=[].concat(t.header(a.value)):(n=[m(X,()=>[m(ae,{lines:l.labelLines},()=>l.label||""),l.caption?m(ae,{lines:l.captionLines,caption:!0},()=>l.caption):null])],l.icon&&n[l.switchToggleSide===!0?"push":"unshift"](m(X,{side:l.switchToggleSide===!0,avatar:l.switchToggleSide!==!0},()=>m(Y,{name:l.icon})))),l.disable!==!0&&l.hideExpandIcon!==!0&&n[l.switchToggleSide===!0?"unshift":"push"](de()),n}function ue(){const n={ref:"item",style:l.headerStyle,class:l.headerClass,dark:S.value,disable:l.disable,dense:l.dense,insetLevel:l.headerInsetLevel};return i.value===!0&&(n.clickable=!0,n.onClick=q,Object.assign(n,L.value===!0?d.value:c.value)),m(Be,n,re)}function ce(){return Ue(m("div",{key:"e-content",class:"q-expansion-item__content relative-position",style:H.value,id:_.value},ye(t.default)),[[Ce,b.value]])}function me(){const n=[ue(),m(De,{duration:l.duration,onShow:se,onHide:ie},ce)];return l.expandSeparator===!0&&n.push(m(R,{class:"q-expansion-item__border q-expansion-item__border--top absolute-top",dark:S.value}),m(R,{class:"q-expansion-item__border q-expansion-item__border--bottom absolute-bottom",dark:S.value})),n}return l.group!==void 0&&ee(),Ie(()=>{I!==void 0&&I()}),()=>m("div",{class:E.value},[m("div",{class:"q-expansion-item__container relative-position"},me())])}});const He=v("h5",{class:"q-mt-none q-mb-md text-center lt-md"},"\u7BA1\u7406\u9875",-1),Ke=v("div",{class:"text-subtitle2"},"\u8FC7\u6EE4\uFF1A",-1),Me={class:"row q-gutter-md justify-center"},ze=v("div",{class:"text-subtitle2"},"\u59D3\u540D\uFF1A",-1),Ge=v("div",{class:"text-subtitle2"},"\u7535\u8BDD\uFF1A",-1),Fe=v("div",{class:"text-subtitle2"},"\u6027\u522B\uFF1A",-1),Je=v("div",{class:"text-subtitle2"},"\u751F\u65E5:",-1),We=v("div",{class:"text-subtitle2"},"\u521B\u5EFA\u65F6\u95F4\uFF1A",-1),Xe=v("div",{class:"text-subtitle2"},"\u6700\u540E\u767B\u5F55\uFF1A",-1),Ye={align:"right"},Ze={class:"row justify-around"},ma={__name:"ManagementPage",setup(l){const t=Re(),A=Te(),y=x([]),S=x(""),b=x(!1);x([]);const U=x("one"),_=x(""),p=x(),r=x(!1);we(async()=>{await t.verifyUser(),t.user?(await t.getAllUserInfo(),await t.getCustomers()):A.push("/index")});const u=async(d,i,e)=>{if(b.value)return;if(!d||!i||typeof e!="boolean"){t.failureTip("\u53C2\u6570\u6709\u8BEF");return}r.value=!0;const T={id:d,field:i,value:e};await t.axios.post("/user/setuser",T).then(a=>{a.status===201&&t.successTip(a.data.msg)}).catch(a=>{t.failureTip(a.response.data.msg)}).finally(()=>{r.value=!1})},V=async(d,i,e)=>{if(b.value)return;if(!d||typeof e!="boolean"||!i){t.failureTip("\u53C2\u6570\u6709\u8BEF");return}r.value=!0;const T={id:d,customer:i,value:e};try{const a=await t.axios.post("/customer/updatecustomer",T);t.successTip(a.data.msg),e?t.customersAvailable.push(i):t.customersAvailable=t.customersAvailable.filter(c=>c!==i)}catch(a){t.failureTip(a.response.data.msg)}r.value=!1},I=async()=>{if(_.value.length>0)try{const d=await t.axios.post("/customer/newcustomer",{customer:_.value});t.successTip(d.data.msg);const i={_id:d.data._id,customer:_.value,accessable:[]};t.customerAccessList[_.value]=!1,t.customerLists.unshift(i),_.value=""}catch(d){console.log(d),d.response.data.status?t.failureTip(d.response.data.msg):t.failureTip("\u5931\u8D25\uFF0C\u672A\u77E5\u9519\u8BEF\uFF01")}},E=async()=>{if(p.value)try{const d=await t.axios.delete("/customer/delCustomer",{params:{customer:p.value}});t.successTip(d.data.msg),t.customerLists=t.customerLists.filter(i=>i.customer!==p.value),delete t.customerAccessList[p.value],t.customersAvailable=t.customersAvailable.filter(i=>i!==p.value),t.searchData.customer===p.value&&(t.searchData.customer="-\u8BF7\u9009\u62E9-"),p.value=""}catch(d){d.response.data.status?t.failureTip(d.response.data.msg):t.failureTip("\u5931\u8D25\uFF0C\u672A\u77E5\u9519\u8BEF\uFF01")}},H=h(()=>{const d=S.value.toLowerCase().trim();return d?t.originalUsers.filter(i=>i.userInfo.email.toLowerCase().includes(d)):t.originalUsers}),L=async d=>{t.$q.dialog({title:"\u786E\u8BA4\u5220\u9664",message:"\u786E\u8BA4\u8981\u5220\u9664\u8BE5\u7528\u6237\u5417\uFF1F",cancel:!0,persistent:!0,ok:{push:!0,label:"\u786E\u5B9A",color:"green"},cancel:{push:!0,color:"grey",label:"\u53D6\u6D88"}}).onOk(async()=>{await t.axios.delete("/user/deleteuser",{params:{id:d}}).then(i=>{i.status===201&&(y.value=y.value.filter(e=>e._id!==d),t.successTip(i.data.msg))}).catch(i=>{t.failureTip(i.response.data.msg)})}).onCancel(()=>{}).onDismiss(()=>{})};return(d,i)=>(g(),k($e,{class:"q-pa-md"},{default:s(()=>[He,o(C,{modelValue:S.value,"onUpdate:modelValue":i[0]||(i[0]=e=>S.value=e),dense:"",outlined:"",class:"q-py-md"},{before:s(()=>[Ke]),prepend:s(()=>[o(Y,{name:"search"})]),_:1},8,["modelValue"]),v("div",Me,[(g(!0),M(G,null,z(H.value,(e,T)=>(g(),k(je,{key:T,item:e,bordered:"",class:"rounded-borders col-12 col-md-4 col-lg-6 shadow-3"},{default:s(()=>[v("div",{class:Le(["coloum text-center text-h6 q-pa-md",e.userInfo.banned?"text-strike":""])},[j(qe(e.userInfo.email)+" ",1),e.userPrivilege.superUser?(g(),k(F,{key:0,"text-color":"red",icon:"supervisor_account",size:"lg"},{default:s(()=>[o(W,null,{default:s(()=>[j(" \u7BA1\u7406\u5458 ")]),_:1})]),_:1})):$("",!0),e.userInfo.activationCode!=null?(g(),k(F,{key:1,"text-color":"warning",icon:"question_mark",size:"lg"},{default:s(()=>[o(W,null,{default:s(()=>[j(" \u7528\u6237\u672A\u6FC0\u6D3B ")]),_:1})]),_:1})):$("",!0),e.userInfo.banned?(g(),k(F,{key:2,"text-color":"grey",icon:"person_off",size:"lg"},{default:s(()=>[o(W,null,{default:s(()=>[j(" \u7528\u6237\u5DF2\u7981\u7528 ")]),_:1})]),_:1})):$("",!0)],2),o(R),o(N,{"expand-separator":"",icon:"perm_identity",label:"\u7528\u6237\u4FE1\u606F","header-class":"text-green"},{default:s(()=>[o(B,{class:"shadow-3"},{default:s(()=>[o(D,null,{default:s(()=>[o(C,{modelValue:e.userInfo.name,"onUpdate:modelValue":a=>e.userInfo.name=a,dense:"",flat:"",readonly:"","item-aligned":""},{before:s(()=>[ze]),_:2},1032,["modelValue","onUpdate:modelValue"]),o(C,{modelValue:e.userInfo.phone,"onUpdate:modelValue":a=>e.userInfo.phone=a,dense:"",flat:"",readonly:"","item-aligned":""},{before:s(()=>[Ge]),_:2},1032,["modelValue","onUpdate:modelValue"]),o(C,{modelValue:e.userInfo.gender,"onUpdate:modelValue":a=>e.userInfo.gender=a,dense:"",flat:"",readonly:"","item-aligned":""},{before:s(()=>[Fe]),_:2},1032,["modelValue","onUpdate:modelValue"]),o(C,{modelValue:e.userInfo.birth,"onUpdate:modelValue":a=>e.userInfo.birth=a,dense:"",flat:"",readonly:"","item-aligned":""},{before:s(()=>[Je]),_:2},1032,["modelValue","onUpdate:modelValue"]),o(C,{modelValue:e.userInfo.createdAt,"onUpdate:modelValue":a=>e.userInfo.createdAt=a,dense:"",flat:"",readonly:"","item-aligned":""},{before:s(()=>[We]),_:2},1032,["modelValue","onUpdate:modelValue"]),o(C,{modelValue:e.userInfo.lastLogin,"onUpdate:modelValue":a=>e.userInfo.lastLogin=a,dense:"",flat:"",readonly:"","item-aligned":""},{before:s(()=>[Xe]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024)]),_:2},1024),o(N,{"expand-separator":"",icon:"task_alt",label:"\u64CD\u4F5C\u6743\u9650","header-class":"text-primary",disable:e.userInfo.banned},{default:s(()=>[o(B,null,{default:s(()=>[o(D,null,{default:s(()=>[e.userInfo.email!=="47262243@qq.com"?(g(),k(f,{key:0,modelValue:e.userPrivilege.superUser,"onUpdate:modelValue":a=>e.userPrivilege.superUser=a,name:"user.userPrivilege.superUser",color:"green",label:"\u7BA1\u7406\u5458","left-label":"",disable:r.value,onClick:a=>u(e._id,"userPrivilege.superUser",e.userPrivilege.superUser)},null,8,["modelValue","onUpdate:modelValue","disable","onClick"])):$("",!0),o(f,{modelValue:e.userPrivilege.read,"onUpdate:modelValue":a=>e.userPrivilege.read=a,name:"user.userPrivilege.read",color:"green",label:"\u8BFB\u53D6","left-label":"",disable:r.value,onClick:a=>u(e._id,"userPrivilege.read",e.userPrivilege.read)},null,8,["modelValue","onUpdate:modelValue","disable","onClick"]),o(f,{modelValue:e.userPrivilege.add,"onUpdate:modelValue":a=>e.userPrivilege.add=a,name:"user.userPrivilege.add",color:"green",label:"\u589E\u52A0","left-label":"",disable:r.value,onClick:a=>u(e._id,"userPrivilege.add",e.userPrivilege.add)},null,8,["modelValue","onUpdate:modelValue","disable","onClick"]),o(f,{modelValue:e.userPrivilege.edit,"onUpdate:modelValue":a=>e.userPrivilege.edit=a,name:"user.userPrivilege.edit",color:"green",label:"\u7F16\u8F91","left-label":"",disable:r.value,onClick:a=>u(e._id,"userPrivilege.edit",e.userPrivilege.edit)},null,8,["modelValue","onUpdate:modelValue","disable","onClick"]),o(f,{modelValue:e.userPrivilege.delete,"onUpdate:modelValue":a=>e.userPrivilege.delete=a,name:"user.userPrivilege.delete",color:"green",label:"\u5220\u9664","left-label":"",disable:r.value,onClick:a=>u(e._id,"userPrivilege.delete",e.userPrivilege.delete)},null,8,["modelValue","onUpdate:modelValue","disable","onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1032,["disable"]),o(N,{"expand-separator":"",icon:"drafts",label:"\u8BBF\u95EE\u7C7B\u578B","header-class":"text-teal",disable:e.userInfo.banned},{default:s(()=>[o(B,null,{default:s(()=>[o(D,null,{default:s(()=>[o(f,{modelValue:e.databasePermissions.IP,"onUpdate:modelValue":a=>e.databasePermissions.IP=a,color:"green",label:"\u7EC8\u7AEF","left-label":"",disable:r.value,onClick:a=>u(e._id,"databasePermissions.IP",e.databasePermissions.IP)},null,8,["modelValue","onUpdate:modelValue","disable","onClick"]),o(f,{modelValue:e.databasePermissions.Phone,"onUpdate:modelValue":a=>e.databasePermissions.Phone=a,color:"green",label:"\u7535\u8BDD","left-label":"",disable:r.value,onClick:a=>u(e._id,"databasePermissions.Phone",e.databasePermissions.Phone)},null,8,["modelValue","onUpdate:modelValue","disable","onClick"]),o(f,{modelValue:e.databasePermissions.Printer,"onUpdate:modelValue":a=>e.databasePermissions.Printer=a,color:"green",label:"\u8017\u6750","left-label":"",disable:r.value,onClick:a=>u(e._id,"databasePermissions.Printer",e.databasePermissions.Printer)},null,8,["modelValue","onUpdate:modelValue","disable","onClick"]),o(f,{modelValue:e.databasePermissions.Datacenter,"onUpdate:modelValue":a=>e.databasePermissions.Datacenter=a,color:"green",label:"\u673A\u623F","left-label":"",disable:r.value,onClick:a=>u(e._id,"databasePermissions.Datacenter",e.databasePermissions.Datacenter)},null,8,["modelValue","onUpdate:modelValue","disable","onClick"]),o(f,{modelValue:e.databasePermissions.Surveillance,"onUpdate:modelValue":a=>e.databasePermissions.Surveillance=a,color:"green",label:"\u76D1\u63A7","left-label":"",disable:r.value,onClick:a=>u(e._id,"databasePermissions.Surveillance",e.databasePermissions.Surveillance)},null,8,["modelValue","onUpdate:modelValue","disable","onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1032,["disable"]),o(N,{"expand-separator":"",icon:"place",label:"\u5BA2\u6237\u63A7\u5236","header-class":"text-info",disable:e.userInfo.banned},{default:s(()=>[o(B,null,{default:s(()=>[o(D,null,{default:s(()=>[(g(!0),M(G,null,z(Q(t).customerAccessList,(a,c)=>(g(),k(f,{key:c,modelValue:Q(t).customerAccessList[c],"onUpdate:modelValue":q=>Q(t).customerAccessList[c]=q,color:"green",label:c,"left-label":"",disable:r.value,onClick:q=>V(e._id,c,Q(t).customerAccessList[c])},null,8,["modelValue","onUpdate:modelValue","label","disable","onClick"]))),128))]),_:2},1024),o(R,{inset:""}),o(Ne,{modelValue:U.value,"onUpdate:modelValue":i[1]||(i[1]=a=>U.value=a),class:"text-teal"},{default:s(()=>[o(le,{label:"\u589E\u52A0",name:"one"}),o(le,{label:"\u5220\u9664",name:"two"})]),_:1},8,["modelValue"]),o(Oe,{modelValue:U.value,"onUpdate:modelValue":i[4]||(i[4]=a=>U.value=a),animated:""},{default:s(()=>[o(te,{name:"one"},{default:s(()=>[o(C,{modelValue:_.value,"onUpdate:modelValue":i[2]||(i[2]=a=>_.value=a),label:"\u5BA2\u6237\u540D\u79F0",maxlength:"10",filled:"",dense:"",onKeyup:Qe(I,["enter"])},{append:s(()=>[o(J,{round:"",dense:"",flat:"",icon:"add",color:"green",onClick:I})]),_:1},8,["modelValue","onKeyup"])]),_:1}),o(te,{name:"two"},{default:s(()=>[(g(!0),M(G,null,z(Q(t).customerAccessList,(a,c)=>(g(),k(Ae,{key:c,modelValue:p.value,"onUpdate:modelValue":i[3]||(i[3]=q=>p.value=q),label:c,val:c},null,8,["modelValue","label","val"]))),128)),v("div",Ye,[o(J,{label:"\u5220\u9664",color:"red",icon:"delete",onClick:E})])]),_:1})]),_:1},8,["modelValue"])]),_:2},1024)]),_:2},1032,["disable"]),e.userInfo.email!==Q(t).user.userInfo.email?(g(),k(N,{key:0,"expand-separator":"",icon:"manage_accounts",label:"\u8D26\u6237\u7BA1\u7406","header-class":"text-indigo",disable:e.userInfo.banned},{default:s(()=>[o(B,null,{default:s(()=>[o(D,null,{default:s(()=>[v("div",Ze,[o(f,{modelValue:e.userInfo.banned,"onUpdate:modelValue":a=>e.userInfo.banned=a,color:"green",label:"\u7981\u7528\u8BE5\u8D26\u6237","left-label":"",disable:r.value,onClick:a=>u(e._id,"banned",e.userInfo.banned)},null,8,["modelValue","onUpdate:modelValue","disable","onClick"]),o(J,{label:"\u5220\u9664\u8BE5\u7528\u6237",color:"grey-4","text-color":"red",onClick:a=>L(e._id)},null,8,["onClick"])])]),_:2},1024)]),_:2},1024)]),_:2},1032,["disable"])):$("",!0)]),_:2},1032,["item"]))),128))])]),_:1}))}};export{ma as default};
